<%- include('header') %>
<% var page = 'admin'; %>

<h1 style="color:#fff; margin-bottom:20px;">Admin</h1>

<div class="two-col">
  <div>
    <div class="card">
      <h3>Current Season</h3>
      <% if (season) { %>
        <table>
          <tr><td style="color:#888;">Name</td><td><strong><%= season.name %></strong></td></tr>
          <tr><td style="color:#888;">Start Date</td><td><%= season.start_date %></td></tr>
          <tr><td style="color:#888;">Game Day</td><td><%= season.game_day %></td></tr>
          <tr><td style="color:#888;">Divisions</td><td><%= divisions.length %></td></tr>
        </table>
        <div style="margin-top:12px;">
          <form method="POST" action="<%= base %>/admin/regenerate" onsubmit="return confirm('This will delete all current game results and regenerate schedules. Are you sure?')">
            <button type="submit" class="btn btn-danger">Regenerate All Schedules</button>
          </form>
        </div>
      <% } else { %>
        <p style="color:#666;">No active season.</p>
      <% } %>
    </div>

    <div class="card">
      <h3>Create New Season</h3>
      <form method="POST" action="<%= base %>/admin/season">
        <div class="form-group">
          <label>Season Name</label>
          <input type="text" name="name" required placeholder="Fall 2026">
        </div>
        <div class="form-group">
          <label>Start Date</label>
          <input type="date" name="start_date" required>
        </div>
        <div class="form-group">
          <label>Game Day</label>
          <select name="game_day">
            <option value="Sunday">Sunday</option>
            <option value="Monday">Monday</option>
            <option value="Tuesday">Tuesday</option>
            <option value="Wednesday">Wednesday</option>
            <option value="Thursday">Thursday</option>
            <option value="Friday">Friday</option>
            <option value="Saturday" selected>Saturday</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary">Create Season</button>
      </form>
      <p style="margin-top:8px; font-size:0.8em; color:#666;">Creating a new season deactivates the current one.</p>
    </div>
  </div>

  <div>
    <div class="card">
      <h3>Blackout Dates</h3>
      <% if (season) { %>
        <% if (blackouts.length > 0) { %>
          <table>
            <thead><tr><th>Date</th><th>Reason</th><th></th></tr></thead>
            <tbody>
            <% for (const b of blackouts) { %>
              <tr>
                <td><%= b.date %></td>
                <td><%= b.reason || 'â€”' %></td>
                <td>
                  <form method="POST" action="<%= base %>/admin/blackout/delete/<%= b.id %>" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm">Remove</button>
                  </form>
                </td>
              </tr>
            <% } %>
            </tbody>
          </table>
        <% } else { %>
          <p style="color:#666; margin-bottom:12px;">No blackout dates set.</p>
        <% } %>

        <form method="POST" action="<%= base %>/admin/blackout" style="margin-top:12px;">
          <div class="form-inline">
            <div class="form-group">
              <label>Date</label>
              <input type="date" name="date" required>
            </div>
            <div class="form-group">
              <label>Reason</label>
              <input type="text" name="reason" placeholder="Easter, Weather, etc.">
            </div>
            <button type="submit" class="btn btn-primary">Add Blackout</button>
          </div>
        </form>
        <p style="margin-top:8px; font-size:0.8em; color:#666;">After adding blackout dates, regenerate schedules to apply them.</p>
      <% } else { %>
        <p style="color:#666;">Create a season first.</p>
      <% } %>
    </div>
  </div>
</div>

<%- include('footer') %>
